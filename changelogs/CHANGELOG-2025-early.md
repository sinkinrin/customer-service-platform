# Changelog Archive - 2025 Early Versions

This file contains archived changelog entries from early 2025 (v0.1.0 - v0.1.9).

For recent changes, see [CHANGELOG.md](../CHANGELOG.md).

---

## [0.1.9] - 2025-11-18

### ğŸ› Bugä¿®å¤

#### ä¿®å¤Admin FAQåˆ†ç±»ç®¡ç†IDä¸ä¸€è‡´é—®é¢˜
- **æ–‡ä»¶**: `src/components/admin/faq-form-dialog.tsx`, `src/app/admin/faq/page.tsx`
- **é—®é¢˜**:
  - Admin FAQç®¡ç†é¡µé¢å°†`category_id`è½¬æ¢ä¸ºæ˜¾ç¤ºå­—ç¬¦ä¸²`"Category X"`
  - ç¼–è¾‘æ—¶ä»å­—ç¬¦ä¸²è§£æå›IDï¼Œå¯¼è‡´åˆ†ç±»ä¿¡æ¯ä¸å‡†ç¡®
  - `FAQFormDialog`ç¡¬ç¼–ç CATEGORIESæ•°ç»„ï¼Œæ— æ³•åæ˜ æ•°æ®åº“ä¸­çš„çœŸå®åˆ†ç±»
- **ä¿®å¤**:
  - `FAQManagementPage`æ–°å¢`categories` Mapï¼Œä¿å­˜çœŸå®`category_id`å’Œ`category_name`
  - `fetchItems`ä»`/api/faq/categories`è·å–åˆ†ç±»æ•°æ®å¹¶æ˜ å°„åˆ°FAQåˆ—è¡¨
  - `FAQFormDialog`ç§»é™¤ç¡¬ç¼–ç ï¼Œæ”¹ä¸ºåŠ¨æ€ä»`/api/faq/categories`è·å–åˆ†ç±»
  - ä¼ é€’ç»™Dialogçš„`article.category_id`ä½¿ç”¨çœŸå®IDï¼Œä¸å†ä»å­—ç¬¦ä¸²è§£æ
- **å½±å“**: Adminç¼–è¾‘FAQæ—¶åˆ†ç±»é€‰æ‹©å‡†ç¡®ï¼Œæ–°å»ºåˆ†ç±»ç«‹å³å¯ç”¨ï¼Œæ— éœ€åˆ·æ–°é¡µé¢

#### ä¿®å¤Customerå¯¹è¯é¡µé¢AIæ¨¡å¼ä¸‹æ— æ³•æ¥æ”¶è½¬äººå·¥äº‹ä»¶
- **æ–‡ä»¶**: `src/app/customer/conversations/[id]/page.tsx`
- **é—®é¢˜**:
  - SSEè¿æ¥ä»…åœ¨`mode === 'human'`æ—¶å¯ç”¨
  - ç”¨æˆ·åœ¨AIæ¨¡å¼ä¸‹æ— æ³•æ¥æ”¶`conversation_transferred`äº‹ä»¶
  - è½¬äººå·¥åéœ€è¦æ‰‹åŠ¨åˆ·æ–°é¡µé¢æ‰èƒ½çœ‹åˆ°äººå·¥å›å¤
- **ä¿®å¤**:
  - SSEè¿æ¥`enabled`å‚æ•°æ”¹ä¸º`true`ï¼Œå§‹ç»ˆä¿æŒè¿æ¥
  - æ·»åŠ `conversationId`è¿‡æ»¤ï¼Œä»…å¤„ç†å½“å‰å¯¹è¯çš„äº‹ä»¶
  - `conversation_transferred`äº‹ä»¶ç«‹å³åˆ‡æ¢åˆ°humanæ¨¡å¼å¹¶åŠ è½½æ¶ˆæ¯
  - `new_message`äº‹ä»¶ä»…åœ¨humanæ¨¡å¼ä¸‹å¤„ç†ï¼Œé¿å…ä¸AIæ¶ˆæ¯å†²çª
- **å½±å“**: ç”¨æˆ·åœ¨AIæ¨¡å¼ä¸‹è½¬äººå·¥æ—¶ç«‹å³åˆ‡æ¢ç•Œé¢ï¼Œæ— éœ€åˆ·æ–°é¡µé¢ï¼Œä½“éªŒæ›´æµç•…

#### å®ç°Customerå·¥å•åˆ—è¡¨åˆ†é¡µåŠŸèƒ½
- **æ–‡ä»¶**: `src/app/customer/my-tickets/page.tsx`
- **é—®é¢˜**:
  - å·¥å•åˆ—è¡¨ä»…è·å–å‰50æ¡å·¥å•ï¼ˆ`limit=50`ï¼‰
  - è¶…è¿‡50ä¸ªå·¥å•çš„ç”¨æˆ·æ— æ³•è®¿é—®å†å²å·¥å•
  - å¿½ç•¥APIè¿”å›çš„`hasMore`åˆ†é¡µå…ƒæ•°æ®
- **ä¿®å¤**:
  - æ–°å¢`page`ã€`hasMore`ã€`loadingMore`çŠ¶æ€è·Ÿè¸ªåˆ†é¡µ
  - `fetchTickets`æ”¯æŒåˆ†é¡µå‚æ•°å’Œappendæ¨¡å¼
  - æ·»åŠ "åŠ è½½æ›´å¤š"æŒ‰é’®ï¼Œç‚¹å‡»åè¯·æ±‚ä¸‹ä¸€é¡µå¹¶è¿½åŠ åˆ°åˆ—è¡¨
  - å½“`hasMore=true`æ—¶æ˜¾ç¤ºæŒ‰é’®ï¼Œç›´åˆ°åŠ è½½å…¨éƒ¨å·¥å•
- **å½±å“**: ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å†å²å·¥å•ï¼Œæ— 50æ¡é™åˆ¶

### ğŸ“ æ–‡æ¡£æ›´æ–°

- æ›´æ–°OpenSpecææ¡ˆ`update-faq-conversation-ticket-fixes`çš„æ‰€æœ‰ä»»åŠ¡ä¸ºå·²å®ŒæˆçŠ¶æ€

---

## [0.1.8] - 2025-11-18

### ğŸ”’ å®‰å…¨ä¿®å¤

#### ä¿®å¤FAQå†…å®¹XSSæ³¨å…¥æ¼æ´
- **æ–‡ä»¶**: `src/app/customer/faq/[id]/page.tsx`, `src/components/faq/article-card.tsx`
- **é—®é¢˜**: FAQè¯¦æƒ…é¡µå’Œæœç´¢å¡ç‰‡ç›´æ¥ä½¿ç”¨`dangerouslySetInnerHTML`æ¸²æŸ“æ•°æ®åº“å†…å®¹ï¼Œå­˜åœ¨XSSå®‰å…¨é£é™©
- **ä¿®å¤**:
  - å¼•å…¥`dompurify`åº“å¯¹HTMLå†…å®¹è¿›è¡Œæ¸…æ´—
  - FAQè¯¦æƒ…é¡µï¼šä½¿ç”¨`DOMPurify.sanitize()`æ¸…æ´—æ–‡ç« å†…å®¹
  - ArticleCardï¼šåœ¨æœç´¢é«˜äº®æ—¶ä»…å…è®¸`<mark>`æ ‡ç­¾ï¼Œæ¸…æ´—æ‰€æœ‰å…¶ä»–HTML
- **å½±å“**: é˜»æ­¢æ¶æ„è„šæœ¬æ³¨å…¥ï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨

### ğŸ› Bugä¿®å¤

#### ä¿®å¤å¯¹è¯æ¶ˆæ¯åˆ†é¡µå¯¼è‡´æœ€æ–°æ¶ˆæ¯ä¸¢å¤±
- **æ–‡ä»¶**: `src/app/api/conversations/[id]/messages/route.ts`, `src/lib/hooks/use-conversation.ts`
- **é—®é¢˜**:
  - APIæŒ‰æ—¶é—´å‡åºæ’åºå`slice(offset, offset + limit)`ï¼Œå¯¼è‡´åªè¿”å›æœ€æ—§çš„50æ¡æ¶ˆæ¯
  - Hookå†™æ­»`limit=50`ä¸”`offset=0`ï¼Œè¶…è¿‡50æ¡çš„å¯¹è¯ä¼šä¸¢å¤±æœ€æ–°æ¶ˆæ¯
- **ä¿®å¤**:
  - APIæ”¹ä¸ºæŒ‰`created_at`å€’åºæ’åºï¼ˆæœ€æ–°æ¶ˆæ¯åœ¨å‰ï¼‰
  - Hookæ”¯æŒåŠ¨æ€`limit`å‚æ•°ï¼ˆé»˜è®¤1000ï¼‰ï¼Œåœ¨å‰ç«¯åè½¬æ¶ˆæ¯é¡ºåºä»¥æ­£ç¡®æ˜¾ç¤º
  - ä¿ç•™åˆ†é¡µåŠŸèƒ½ï¼Œæ”¯æŒé€šè¿‡`offset`åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯
- **å½±å“**: é•¿å¯¹è¯ç°åœ¨èƒ½æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰æœ€æ–°æ¶ˆæ¯ï¼Œæ”¯æŒåŠ è½½å®Œæ•´å¯¹è¯å†å²

#### ä¿®å¤å·¥å•åˆ—è¡¨å®¢æˆ·ä¿¡æ¯æ˜¾ç¤ºä¸ºundefined
- **æ–‡ä»¶**: `src/app/api/tickets/route.ts`, `src/app/api/tickets/search/route.ts`, `src/app/api/tickets/[id]/route.ts`
- **é—®é¢˜**:
  - `transformTicket`ä»…è¿”å›`priority`å’Œ`state`æ–‡æœ¬ï¼ŒæœªåŒ…å«å®¢æˆ·ä¿¡æ¯
  - å·¥å•åˆ—è¡¨æ˜¾ç¤º`Customer: undefined`
- **ä¿®å¤**:
  - æ‰©å±•`transformTicket`å‡½æ•°ï¼Œæ¥å—å®¢æˆ·ä¿¡æ¯å‚æ•°
  - APIæ‰¹é‡è·å–å®¢æˆ·ä¿¡æ¯ï¼ˆ`zammadClient.getUser`ï¼‰ï¼Œåˆ›å»º`customer_id â†’ user`æ˜ å°„
  - è¿”å›`customer`å­—æ®µï¼ˆå®¢æˆ·å§“åæˆ–é‚®ç®±ï¼‰å’Œ`customer_email`å­—æ®µ
  - å¤±è´¥é™çº§æ˜¾ç¤º`Customer #${ticket.customer_id}`
- **å½±å“**: å·¥å•åˆ—è¡¨å’Œè¯¦æƒ…ç°åœ¨æ­£ç¡®æ˜¾ç¤ºå®¢æˆ·èº«ä»½ï¼Œæ–¹ä¾¿ç®¡ç†å‘˜å¿«é€Ÿè¯†åˆ«

### ğŸ“¦ ä¾èµ–æ›´æ–°

- æ–°å¢: `dompurify@^3.2.3` - HTMLå†…å®¹æ¸…æ´—åº“
- æ–°å¢: `@types/dompurify@^3.2.0` - DOMPurifyç±»å‹å®šä¹‰

---

## [0.1.7] - 2025-11-18

### ğŸ› Bugä¿®å¤ (Code Review Issues)

#### ä¿®å¤SearchBarè‡ªåŠ¨æœç´¢æ— æ³•æ¸…é™¤ç»“æœ
- **æ–‡ä»¶**: `src/components/faq/search-bar.tsx`
- é—®é¢˜ï¼šé˜²æŠ–effectåªåœ¨`debouncedQuery !== defaultValue`æ—¶è§¦å‘ï¼Œæ¸…ç©ºè¾“å…¥æ—¶ä¸ä¼šè°ƒç”¨`onSearch('')`
- ä¿®å¤ï¼šç§»é™¤`defaultValue`æ¯”è¾ƒæ¡ä»¶ï¼Œç¡®ä¿æ¯æ¬¡`debouncedQuery`å˜åŒ–éƒ½è§¦å‘æœç´¢
- å½±å“ï¼šæ¸…ç©ºæœç´¢æ¡†ç°åœ¨èƒ½æ­£ç¡®æ˜¾ç¤ºçƒ­é—¨FAQ

#### ä¿®å¤AIå¯¹è¯å†å²åªåŠ è½½æœ€æ—§çš„50æ¡æ¶ˆæ¯
- **æ–‡ä»¶**: `src/app/customer/conversations/[id]/page.tsx:92`
- é—®é¢˜ï¼šAPIè°ƒç”¨æœªä¼ é€’`limit`å‚æ•°ï¼Œé»˜è®¤è¿”å›å‰50æ¡ï¼Œé•¿å¯¹è¯ä¼šä¸¢å¤±æœ€æ–°æ¶ˆæ¯
- ä¿®å¤ï¼šæ·»åŠ `?limit=1000`å‚æ•°ï¼ŒåŠ è½½æ‰€æœ‰AIæ¶ˆæ¯
- å½±å“ï¼šAIå¯¹è¯ç°åœ¨å¯ä»¥åŠ è½½æœ€å¤š1000æ¡æ¶ˆæ¯ï¼Œä¿ç•™å®Œæ•´ä¸Šä¸‹æ–‡

#### æ·»åŠ FAQç¼“å­˜å¤±æ•ˆæœºåˆ¶
- **æ–‡ä»¶**: `src/app/api/faq/route.ts`, `src/app/api/admin/faq/articles/route.ts`, `src/app/api/admin/faq/categories/route.ts`
- é—®é¢˜ï¼šFAQç¼“å­˜10åˆ†é’Ÿï¼Œä½†æ–‡ç« /åˆ†ç±»ç¼–è¾‘ã€è¯„åˆ†å˜åŒ–æ—¶ä¸æ¸…é™¤ç¼“å­˜ï¼Œæ˜¾ç¤ºé™ˆæ—§å†…å®¹
- ä¿®å¤ï¼š
  - æ·»åŠ `forceRefresh`æŸ¥è¯¢å‚æ•°ï¼Œå…è®¸ç»•è¿‡ç¼“å­˜ï¼ˆç®¡ç†å‘˜éªŒè¯ç¼–è¾‘ç”¨ï¼‰
  - åœ¨admin APIçš„åˆ›å»º/æ›´æ–°/åˆ é™¤æ“ä½œåè‡ªåŠ¨æ¸…é™¤FAQå’Œåˆ†ç±»ç¼“å­˜
  - æ–‡ç« æ“ä½œæ¸…é™¤`faqCache`ï¼Œåˆ†ç±»æ“ä½œæ¸…é™¤`faqCache`å’Œ`categoriesCache`
- å½±å“ï¼šç®¡ç†å‘˜ç¼–è¾‘åï¼Œç”¨æˆ·ç«‹å³çœ‹åˆ°æœ€æ–°å†…å®¹

#### ä¿®å¤serverlesså®šæ—¶å™¨æ³„æ¼
- **æ–‡ä»¶**: `src/lib/cache/simple-cache.ts:133-155`
- é—®é¢˜ï¼šæ¨¡å—ä½œç”¨åŸŸçš„`setInterval`åœ¨serverlessç¯å¢ƒä¸­ä¿æŒevent loopæ´»è·ƒï¼Œé˜»æ­¢workerç©ºé—²
- ä¿®å¤ï¼š
  - ä½¿ç”¨`globalThis.__cacheCleanupStarted`å®ˆå«ï¼Œé˜²æ­¢çƒ­é‡è½½æ—¶åˆ›å»ºå¤šä¸ªå®šæ—¶å™¨
  - ä½¿ç”¨`timer.unref()`å…è®¸è¿›ç¨‹åœ¨åªæœ‰æ­¤å®šæ—¶å™¨æ—¶é€€å‡º
- å½±å“ï¼šserverless workerså¯ä»¥æ­£å¸¸ç©ºé—²å’Œé€€å‡ºï¼Œå‡å°‘ç©ºé—²CPUä½¿ç”¨

---

## [0.1.6] - 2025-11-18

### âš¡ æ€§èƒ½ä¼˜åŒ–

#### å†…å­˜çº§LRUç¼“å­˜å®ç°ï¼ˆæ— éœ€Redisï¼‰
- **æ–‡ä»¶**: `src/lib/cache/simple-cache.ts` (æ–°å»º)
- å®ç°è½»é‡çº§å†…å­˜LRUç¼“å­˜ï¼Œé€‚ç”¨äºä½å¹¶å‘åœºæ™¯ï¼ˆ< 100ç”¨æˆ·ï¼‰
- FAQåˆ—è¡¨APIå“åº”æ—¶é—´ä» ~500ms é™è‡³ ~50msï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰
- å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° **70-80%**

#### FAQ APIæŸ¥è¯¢ä¼˜åŒ–ï¼ˆä¿®å¤N+1é—®é¢˜ï¼‰
- **æ–‡ä»¶**: `src/app/api/faq/route.ts`
- 10ç¯‡æ–‡ç« ï¼šä»31æ¬¡æŸ¥è¯¢é™è‡³1æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ—¶é—´å‡å°‘ **90%**

#### æœç´¢é˜²æŠ–ä¼˜åŒ–
- **æ–‡ä»¶**: `src/lib/hooks/use-debounce.ts`, `src/components/faq/search-bar.tsx`
- å‡å°‘APIè°ƒç”¨æ¬¡æ•° **90%+**

#### Reactç»„ä»¶æ¸²æŸ“ä¼˜åŒ–
- **æ–‡ä»¶**: `src/components/faq/search-bar.tsx`, `src/components/faq/article-card.tsx`
- åˆ—è¡¨é¡µé¢æ¸²æŸ“æ€§èƒ½æå‡ **30-40%**

---

## [0.1.5] - 2025-11-18

### ğŸ› ä¿®å¤

#### R1: Ticket SSE æƒé™æ³„éœ²ä¿®å¤
- æ·»åŠ è§’è‰²éªŒè¯ï¼Œåªå…è®¸ staff/admin è¿æ¥åˆ° ticket SSE ç«¯ç‚¹

#### R2: AI æ¶ˆæ¯å‘é€è€…è§’è‰²æ ‡è®°ä¿®å¤
- æ”¯æŒ `metadata.role='ai'` å‚æ•°ï¼Œæ­£ç¡®æ ‡è®° AI æ¶ˆæ¯

#### R3: AI èŠå¤©å†å²åŒæ­¥ä¿®å¤
- ä¿®å¤ AI API è°ƒç”¨æ—¶çš„å†å²è®°å½•æ„å»ºé€»è¾‘

---

## [0.1.4] - 2025-11-18

### ğŸ› ä¿®å¤

#### R1: ç¥¨åŠ¡å®æ—¶SSEäº‹ä»¶å¹¿æ’­
- æ·»åŠ  `broadcastEvent()` è°ƒç”¨åˆ°ç¥¨åŠ¡ CRUD æ“ä½œ

#### R2: APIé”™è¯¯å“åº”è§„èŒƒåŒ–
- ä¿®æ­£æ‰€æœ‰ `errorResponse()` è°ƒç”¨ä½¿ç”¨æ­£ç¡®çš„4å‚æ•°æ ¼å¼

#### R3: AIå¯¹è¯å†å²æŒä¹…åŒ–
- `handleAIMessage()` ç°åœ¨å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°å­˜å‚¨

---

## [0.1.3] - 2025-11-14

### ğŸ› ä¿®å¤

- R1: Admin åŒºåŸŸè¿‡æ»¤å™¨ä½¿ç”¨ group_id
- R2: å¯¹è¯æ›´æ–°åŒæ—¶é€šçŸ¥å®¢æˆ·å’Œå‘˜å·¥
- R3: Staff ç¥¨åŠ¡è¯¦æƒ…é¡µé¢åˆ›å»º

---

## [0.1.2] - 2025-11-14

### ğŸ› ä¿®å¤

- R1: Admin ç¥¨åŠ¡åŒºåŸŸè¿‡æ»¤å™¨ä¿®æ­£
- R2: å¯¹è¯é™„ä»¶æ¶ˆæ¯ç±»å‹ä¿å­˜
- R3: Staff æ ‡è®°å·²è¯»æƒé™æ”¾å®½

---

## [0.1.1] - 2025-11-14

### ğŸ› ä¿®å¤

- R1: Switch-to-AI ç«¯ç‚¹å®‰å…¨åŠ å›º
- R2: Mark-Read æœªè¯»è®¡æ•°æŒ‰å‘˜å·¥éš”ç¦»
- R3: å®¢æˆ·å¯¹è¯é¡µé¢é˜²æ­¢é‡å¤åˆ›å»º

---

## [0.1.0] - 2025-11-14

### Fixed

- R1: FAQ Category Filtering Parameter Compatibility
- R2: Conversation Creation Initial Message Persistence
- R3: Mark-Read Endpoint Participant Authorization
- R4: Staff Unread Count Per-User Isolation
- R5: Customer Ticket Visibility Regardless of Group Reassignment

---

## [Unreleased]

### Added
- Initial changelog file
