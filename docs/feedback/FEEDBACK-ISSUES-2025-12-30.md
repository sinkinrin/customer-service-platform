# 问题反馈汇总 - 2025年12月30日

## 概述

本文档整理自《AI智能服务反馈—Ticket系统测试-2025年12月30日.csv》，共 **18 个问题**（已排除 3 个邮箱相关问题）。

---

## 一、工单消息显示问题

### 1.1 首次对话消息位置错误
| 字段 | 内容 |
|------|------|
| **角色** | 技术支持 |
| **问题** | 首次对话，问题描述是客户提供，应该位于左侧 |
| **反馈人** | Cody |
| **相关代码** | `src/components/conversation/message-list.tsx:266-274` |

**分析**：
- 当前逻辑：`isCustomerMessage` 判断基于 `senderRole === 'customer'`
- 客户消息使用 `justify-end`（右对齐），非客户消息使用 `justify-start`（左对齐）
- **问题**：逻辑是反的！客户消息应该左对齐（自己发的在左边），技术回复应该右对齐

```typescript
// 当前代码 (line 272-274)
isCustomerMessage ? 'justify-end' : 'justify-start'
// 应该改为
isCustomerMessage ? 'justify-start' : 'justify-end'
```

**注意**：需要确认这是针对哪个视角（客户视角 vs 技术支持视角）来调整

---

### 1.2 技术回复发送者名称未翻译
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 客户收到技术回复后，对方名显示"客服"未翻译成英文 |
| **反馈人** | Luca |
| **相关代码** | `src/components/conversation/message-list.tsx:264` 或 API 返回数据 |

**分析**：
- `senderName = message.sender?.full_name || 'Unknown'`
- 如果 Zammad 用户的 `full_name` 存储的是中文"客服"，则会直接显示
- **解决方案**：在 API 层或 UI 层根据 locale 转换发送者名称，或使用通用的 "Support Staff" 标识

---

## 二、工单列表/详情页问题

### 2.1 创建/更新时间格式
| 字段 | 内容 |
|------|------|
| **角色** | Admin |
| **问题** | create 时间和 update 时间，用时间和日期显示 |
| **反馈人** | SHAMY |
| **相关代码** | 工单列表/详情页的时间显示组件 |

**分析**：
- 当前使用相对时间（如 "2 hours ago"）
- 需要改为完整日期时间格式，如 "2025-12-30 14:30"
- 相关文件：`src/app/admin/dashboard/page.tsx:66-78` (`formatRelativeTime`)

---

### 2.2 工单删除按钮不生效
| 字段 | 内容 |
|------|------|
| **角色** | Admin |
| **问题** | 删除按键不生效 |
| **反馈人** | SHAMY |
| **相关代码** | `src/app/api/tickets/[id]/route.ts:455-482` |

**分析**：
- DELETE API 存在且有权限检查
- 需要检查：
  1. 前端是否正确调用 DELETE API
  2. 是否有错误被静默吞掉
  3. Zammad 是否真正支持删除操作

---

### 2.3 "NEW" 标签颜色建议
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 图中的新工单"NEW"标签建议使用亮色的ICON，而不是深色 |
| **反馈人** | Luca |
| **相关代码** | `src/components/ticket/ticket-list.tsx` 中的状态 Badge |

**分析**：
- 建议将 NEW 状态的 Badge 改为更醒目的亮色（如亮蓝、亮绿）

---

### 2.4 工单标题过长无悬浮提示
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 工单标题过长时，鼠标放置在上，应有悬浮文字显示 |
| **反馈人** | Luca |
| **相关代码** | `src/components/ticket/ticket-list.tsx` 标题显示 |

**分析**：
- 需要添加 `title` 属性或 Tooltip 组件显示完整标题

---

## 三、权限/区域问题

### 3.1 未分配工单可被其他区域 Staff 查看
| 字段 | 内容 |
|------|------|
| **角色** | 技术支持 |
| **问题** | 用户创建工单，管理员未分配，Africa 技术账号可以查看 |
| **反馈人** | Cody |
| **相关代码** | `src/app/api/tickets/route.ts` 工单列表权限过滤 |

**分析**：
- 未分配工单（无 group_id）的权限控制需要加强
- 可能的方案：只有 Admin 可以看未分配工单，或按客户区域自动归类

---

### 3.2 亚太客户可看到拉美区工单
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 亚太客户账号可以看到拉美区的工单 |
| **反馈人** | Edward |
| **相关代码** | `src/app/api/tickets/route.ts` 客户工单过滤 |

**分析**：
- 客户应该只能看到自己创建的工单
- 需要检查工单列表 API 的 `customer_id` 过滤逻辑

---

### 3.3 中东 Staff 无邮件回复功能
| 字段 | 内容 |
|------|------|
| **角色** | 技术支持 |
| **问题** | 中东 staff 账号没有邮件回复功能 |
| **反馈人** | Dover |
| **相关代码** | 工单回复组件的权限控制 |

**分析**：
- 可能是 Zammad 用户配置问题，或前端基于区域隐藏了邮件选项
- 需要检查 Staff 回复组件的条件渲染逻辑

---

## 四、附件/上传问题

### 4.1 附件上传按钮样式未翻译
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 客户收到技术回复后，上传附件的按钮样式未转译 |
| **反馈人** | Luca |
| **相关代码** | 附件上传组件的 i18n |

**分析**：
- 检查上传按钮的文本是否使用了 i18n 翻译函数

---

### 4.2 Live 附件无法发送
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 附件不能发送 |
| **反馈人** | Kevin |
| **相关代码** | Live 聊天组件的附件发送功能 |

**分析**：
- Live 聊天的文件上传功能可能未完整实现或存在 Bug

---

## 五、表单/输入问题

### 5.1 必填项提示未翻译
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 提交工单，系统检测必填项未填写的提示是中文，需翻译英文 |
| **反馈人** | Luca |
| **相关代码** | 工单创建表单验证消息 |

**分析**：
- 表单验证错误消息需要使用 i18n

---

### 5.2 输入框长度限制导致无法发送
| 字段 | 内容 |
|------|------|
| **角色** | 技术支持 |
| **问题** | 工单回复页面，输入框输入长度过长字符，无法正常发送 |
| **反馈人** | Cody |
| **相关代码** | 工单回复 API 或 Textarea 组件 |

**分析**：
- 可能是 API 有字符长度限制，或前端验证阻止了提交
- 需要检查 Zammad API 的内容长度限制

---

### 5.3 输入框不自适应高度
| 字段 | 内容 |
|------|------|
| **角色** | 技术支持 |
| **问题** | 输入字符长度，文本框需要适应输入字符数量，当前默认最大只有这么长，显示不全 |
| **反馈人** | Cody |
| **相关代码** | 回复 Textarea 组件 |

**分析**：
- Textarea 需要设置 `rows` 属性动态调整，或使用 auto-resize 功能

---

### 5.4 建议支持粘贴图片
| 字段 | 内容 |
|------|------|
| **角色** | 技术支持 |
| **问题** | 回复客户，应该支持直接粘贴图片，不必每次都作为附件发 |
| **反馈人** | Faith |
| **相关代码** | 富文本编辑器组件 |

**分析**：
- 需要在 Textarea 上监听 `paste` 事件，识别图片数据并自动上传
- 这是一个功能增强需求

---

## 六、统计/显示问题

### 6.1 工单总数显示错误
| 字段 | 内容 |
|------|------|
| **角色** | 技术支持 |
| **问题** | 工单总数显示 7，但是实际只有 3 |
| **反馈人** | Faith |
| **相关代码** | 工单列表分页统计 |

**分析**：
- 可能是统计包含了已删除/隐藏的工单
- 或者是权限过滤后数量不一致

---

## 七、工单分配问题

### 7.1 工单不应默认分配给 Admin
| 字段 | 内容 |
|------|------|
| **角色** | Admin |
| **问题** | 工单不应该默认分配给 admin |
| **反馈人** | Jasper |
| **相关代码** | 工单创建/自动分配逻辑 |

**分析**：
- 检查 Zammad 触发器或 API 的默认分配规则
- 新工单应该保持未分配状态，等待手动或自动分配到对应区域 Staff

---

## 八、客户操作限制

### 8.1 客户无法主动关闭工单
| 字段 | 内容 |
|------|------|
| **角色** | 客户 |
| **问题** | 客户无法主动关闭工单 |
| **反馈人** | Edward |
| **相关代码** | 客户工单详情页 |

**分析**：
- 需要在客户视角添加"关闭工单"按钮
- 调用工单状态更新 API 将状态改为 closed

---

## 问题统计

| 优先级 | 数量 | 说明 |
|--------|------|------|
| **P0 - 阻塞** | 4 | 删除不生效、权限泄露、附件无法发送、无法主动关闭 |
| **P1 - 重要** | 6 | 消息位置、时间格式、工单数量、分配默认值、输入限制 |
| **P2 - 改进** | 8 | UI 样式、翻译、悬浮提示、粘贴图片等 |

---

## 下一步行动

1. 先确认问题分析是否准确
2. 按优先级排序修复
3. 优先处理 P0 级别问题
