# 设计文档：完善Admin管理功能

## 上下文

当前客服平台Admin后台具备基础功能，但看板展示单一、账号管理不够完善。需要增强数据可视化、批量操作和配置管理能力，以满足企业级运营需求。

### 利益相关者
- **系统管理员** - 需要高效管理用户和监控系统
- **运营团队** - 需要数据看板支持决策

## 目标 / 非目标

### 目标
- 提供直观的数据可视化看板
- 支持批量账号导入导出
- 实现完整的用户生命周期管理
- 提供灵活的系统配置能力

### 非目标
- 复杂的权限管理系统（RBAC）
- 多租户支持
- 审计合规功能

## 决策

### 决策：图表库选择
- **选择**：使用 Recharts 作为图表库
- **原因**：
  - 与 React 生态系统良好集成
  - 轻量级，性能优秀
  - 支持响应式设计
  - 项目可能已有相关依赖

### 决策：批量导入方案
- **选择**：前端解析 + 后端批量处理
- **方案详情**：
  1. 前端使用 `xlsx` 或 `papaparse` 解析文件
  2. 预览解析结果，允许用户修正
  3. 分批发送到后端（每批50条）
  4. 后端逐条处理，返回处理结果
- **原因**：
  - 用户可以在提交前预览和修正数据
  - 避免大文件直接上传造成的超时
  - 分批处理提高可靠性

### 决策：统计数据计算
- **选择**：实时计算 + 缓存
- **方案详情**：
  1. 统计API实时查询Zammad数据
  2. 使用内存缓存（或Redis）缓存结果
  3. 缓存TTL设为5分钟
- **原因**：
  - 统计数据不需要实时精确
  - 缓存减少API调用开销
  - 简化实现，无需后台任务

### 决策：用户状态存储
- **选择**：扩展mock-auth中的用户模型
- **方案详情**：
  - 在 `mockUsers` 中添加 `is_active` 字段
  - 登录时检查用户状态
  - 禁用用户无法登录
- **原因**：
  - 与现有认证系统一致
  - 最小化变更

## 风险 / 权衡

### 风险：Zammad API调用限制
- **缓解措施**：实现缓存层减少调用频率
- **缓解措施**：添加请求节流

### 风险：大批量导入性能
- **缓解措施**：分批处理，限制单次导入数量
- **缓解措施**：显示进度条，提供取消选项

### 风险：图表渲染性能
- **缓解措施**：限制数据点数量
- **缓解措施**：使用虚拟化或采样处理大数据集

### 决策：用户区域存储与同步
- **选择**：本地存储 + Zammad 同步
- **方案详情**：
  - 用户 region 字段存储在 mockUsers 中
  - Staff 用户：region 对应 Zammad group_ids
  - Customer 用户：region 存储在 Zammad note 字段
  - 修改区域时同步更新 Zammad
- **原因**：
  - Staff 需要 group 权限来处理对应区域工单
  - Customer 通过 note 记录用于工单分发

### 决策：区域筛选实现
- **选择**：前端筛选（初期）
- **方案详情**：
  - API 返回用户带 region 字段
  - 前端添加区域筛选下拉框
  - 后续可优化为后端筛选
- **原因**：
  - 用户量小时前端筛选够用
  - 快速实现

## 开放问题

1. 是否需要支持更多文件格式（如JSON）的导入？ 答：需要
2. 统计数据的时间范围是否需要可配置？ 答：需要
3. 是否需要将设置持久化到数据库？ 答：需要

