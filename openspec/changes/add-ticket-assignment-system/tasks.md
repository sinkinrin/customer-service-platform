# 任务清单：添加工单分配与员工假期管理

> [!TIP]
> **简化方案**：由于员工较少且在线状态不稳定，仅实现**休假状态管理**（使用 Zammad Out-of-Office API），其他员工默认可分配。

## 1. 假期状态管理（Zammad API）

### 1.1 扩展 ZammadClient
- [ ] 1.1.1 在 `src/lib/zammad/client.ts` 添加 `setOutOfOffice()` 方法
- [ ] 1.1.2 添加 `getOutOfOffice()` 方法
- [ ] 1.1.3 添加 `cancelOutOfOffice()` 方法
- **预计时间**：0.5天
- **优先级**：P0

### 1.2 假期管理 API
- [ ] 1.2.1 创建 `src/app/api/staff/vacation/route.ts`
- [ ] 1.2.2 GET - 获取当前假期状态
- [ ] 1.2.3 PUT - 设置假期时间和代理人
- [ ] 1.2.4 DELETE - 取消假期
- **预计时间**：0.5天
- **优先级**：P0

### 1.3 假期设置 UI
- [ ] 1.3.1 创建 `src/components/staff/vacation-dialog.tsx`
- [ ] 1.3.2 日期范围选择器
- [ ] 1.3.3 代理人选择下拉框
- [ ] 1.3.4 显示当前假期状态
- **预计时间**：1天
- **优先级**：P0

### 1.4 Staff 设置页面更新
- [ ] 1.4.1 更新 `src/app/staff/settings/page.tsx`
- [ ] 1.4.2 添加假期管理卡片
- **预计时间**：0.5天
- **优先级**：P1

## 2. 手动分配功能

### 2.1 分配 API
- [ ] 2.1.1 创建 `src/app/api/tickets/[id]/assign/route.ts`
- [ ] 2.1.2 PUT - 分配给指定员工（更新 Zammad ticket.owner_id）
- [ ] 2.1.3 DELETE - 取消分配
- **预计时间**：0.5天
- **优先级**：P1

### 2.2 获取可分配员工 API
- [ ] 2.2.1 创建 `src/app/api/staff/available/route.ts`
- [ ] 2.2.2 获取所有 Staff（排除休假员工）
- [ ] 2.2.3 返回每人当前工单数
- **预计时间**：0.5天
- **优先级**：P1

### 2.3 分配弹窗组件
- [ ] 2.3.1 创建 `src/components/admin/ticket-assign-dialog.tsx`
- [ ] 2.3.2 显示可分配员工列表
- [ ] 2.3.3 显示员工当前工单数
- [ ] 2.3.4 休假员工标记或隐藏
- [ ] 2.3.5 按工单数排序，推荐负载低的员工
- **预计时间**：1天
- **优先级**：P1

### 2.4 工单列表集成
- [ ] 2.4.1 在工单列表添加"分配"按钮
- [ ] 2.4.2 在工单详情页添加"重新分配"功能
- **预计时间**：0.5天
- **优先级**：P1

## 3. Admin 员工视图

### 3.1 员工状态概览
- [ ] 3.1.1 在 Admin 页面显示员工假期状态
- [ ] 3.1.2 显示当前休假员工
- [ ] 3.1.3 显示即将休假员工
- [ ] 3.1.4 显示每人工单数统计
- **预计时间**：1天
- **优先级**：P2

## 4. 测试验证

- [ ] 4.1 设置假期后验证 Zammad out_of_office 字段
- [ ] 4.2 验证休假员工在分配列表中被标记/排除
- [ ] 4.3 测试手动分配功能
- [ ] 4.4 测试假期代理人工单转移
- **预计时间**：0.5天

---

## 总结

| 功能 | 实现方式 | 开发量 |
|------|---------|--------|
| 假期状态 | Zammad Out-of-Office API | 2.5天 |
| 手动分配 | API + UI | 2.5天 |
| 员工视图 | 前端开发 | 1天 |
| **总计** | | **约 6天** |

**已移除**：在线/忙碌状态管理（不适用于小团队）
