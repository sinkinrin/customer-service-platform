# TODO未实现功能清单

> 扫描日期: 2025-12-23
> **最后更新: 2026-01-21**
> 扫描范围: src目录下所有代码文件

---

## 更新说明 (2026-01-21)

以下功能在原扫描后已实现，状态已更新：

| 原 TODO | 当前状态 | 实现位置 |
|---------|----------|----------|
| P0: 工单附件上传 | ✅ **已实现** | `useFileUpload` hook + `/api/attachments/upload` |
| P1: 工单导出功能 | ✅ **已实现** | `/api/tickets/export` (CSV) |
| P1: 密码更新 | ✅ **已实现** | `PUT /api/user/password` |
| P2: Webhook处理 | ✅ **已实现** | 完整处理 + 通知 + SSE |

---

## ~~🔴 P0 - 影响核心功能~~ (已解决)

### ~~1. 工单附件上传~~ ✅ 已实现
- **状态**: ✅ **已实现** (2026-01)
- **实现**:
  - `src/lib/hooks/use-file-upload.ts` - 共享文件上传 hook
  - `src/app/api/attachments/upload/route.ts` - 上传到 Zammad
  - 支持 `attachment_ids` 和 `form_id` 引用

---

## 🟡 P1 - 影响用户体验

### ~~2. 工单导出功能~~ ✅ 已实现
- **状态**: ✅ **已实现** (2026-01)
- **实现**: `src/app/api/tickets/export/route.ts`
- **功能**: CSV 导出，包含工单详情、客户、处理人、满意度

### 3. 用户注册API
- **状态**: ⚠️ 部分实现 - 使用 Zammad 用户创建
- **说明**: 通过 `/api/admin/users` POST 可创建用户，但无公开注册

### ~~4. 密码重置/更新~~ ✅ 已实现
- **状态**: ✅ **密码更新已实现** (2026-01)
- **实现**: `PUT /api/user/password` - 验证当前密码后更新
- **未实现**: 密码重置（忘记密码）流程

---

## 🟢 P2 - 技术债务/后续优化

### ~~5. Zammad Webhook处理~~ ✅ 已实现
- **状态**: ✅ **已实现** (2026-01)
- **实现**: `src/app/api/webhooks/zammad/route.ts`
- **功能**:
  - 存储 TicketUpdate 到数据库
  - 创建 in-app 通知
  - SSE 广播实时更新

### 6. 文件存储系统
- **状态**: ⚠️ 本地存储 + Zammad upload_caches
- **说明**: 附件通过 Zammad API 上传，本地文件用于头像等

### 7. Session管理
- **状态**: ⚠️ 使用 NextAuth.js JWT sessions
- **说明**: 无需传统 session 管理，JWT 无状态

### 8. 业务类型管理
- **状态**: ❌ 仍未实现
- **代码**: `businessTypes: []` 返回空数组

### 9. ~~认证系统~~ ✅ 已实现
- **状态**: ✅ **已实现** - NextAuth.js v5 + Zammad
- **说明**: Mock auth 保留用于开发测试

### 10. 开发环境自动登录
- **状态**: ✅ 开发功能，正常工作

---

## 📊 统计 (更新后)

| 优先级 | 原数量 | 已完成 | 剩余 |
|--------|--------|--------|------|
| P0 | 1 | 1 | 0 |
| P1 | 4 | 2 | 2 |
| P2 | 6 | 3 | 3 |

---

## 剩余待处理项

1. **公开用户注册** - 当前只有管理员可创建用户
2. **密码重置流程** - 忘记密码发送邮件
3. **业务类型管理** - Admin settings 功能
4. **云存储迁移** - 生产环境优化（可选）
5. **Session 调试页面** - 开发工具（低优先级）
