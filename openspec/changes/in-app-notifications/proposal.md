# 站内通知系统 (In-App Notifications)

## 背景

当前系统存在以下问题：

1. **未读工单提醒分散**: 使用 `unread-store.ts` (Zustand + localStorage) 存储未读状态，仅限于工单
2. **通知仅限 Toast**: 通过 `ticket-updates-provider.tsx` 显示即时 Toast，但无持久化
3. **无历史通知**: 用户刷新页面后无法查看历史通知
4. **缺乏统一入口**: 没有通知中心，用户需要逐个检查工单

## 目标

建立统一的站内通知系统，实现：

1. **统一通知管理**: 所有事件（工单、系统、任务分配等）通过统一通知系统处理
2. **持久化存储**: 通知存储在数据库中，支持历史查看
3. **通知中心 UI**: 在导航栏添加通知铃铛图标，点击展开通知列表
4. **实时推送**: 集成现有轮询机制，支持实时通知
5. **未读迁移**: 将现有未读工单状态迁移到通知系统

## 范围

### 包含

- 通知数据模型设计
- 通知 API 设计
- 通知中心 UI 组件
- 与现有工单更新系统集成
- 未读状态统一管理

### 排除

- 邮件通知（未来扩展）
- 推送通知（PWA/Mobile，未来扩展）
- 通知模板管理后台

## 成功标准

1. 用户可在通知中心查看所有通知历史
2. 新工单消息/状态变更自动生成通知
3. 通知支持已读/未读状态切换
4. 未读通知数量在导航栏显示
5. 现有未读工单功能平滑迁移

## 利益相关者

- **Customer**: 收到工单回复、状态变更通知
- **Staff**: 收到新工单分配、客户回复、系统提醒
- **Admin**: 收到系统异常、关键操作通知

## 时间估计

- 设计: 1 天
- 后端实现: 2 天
- 前端实现: 2 天
- 测试 & 迁移: 1 天
